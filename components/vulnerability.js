export default function Vulnerability({ advisory, vuln }) {

  advisory.identifiers.sort((id, another) => id.type.localeCompare(another.type))
  const identifier = advisory.identifiers[0]?.value ?? 'Unknown identifier'

  const severityColor = () => {
    switch (vuln.severity) {
      case 'LOW': return 'yellow-400'
      case 'MODERATE': return 'orange-400'
      case 'HIGH': return 'red-500'
      case 'CRITICAL': return 'red-800'
    }
  }

  const packageLink = () => {
    switch (vuln.package.ecosystem) {
      case 'COMPOSER': return `https://packagist.org/packages/${vuln.package.name}`
      case 'GO': return `https://pkg.go.dev/${vuln.package.name}`
      case 'MAVEN': return `https://mvnrepository.com/artifact/${vuln.package.name.replace(':', '/')}`
      case 'NPM': return `https://www.npmjs.com/package/${vuln.package.name}`
      case 'NUGET': return `https://www.nuget.org/packages/${vuln.package.name}`
      case 'PIP': return `https://pypi.org/project/${vuln.package.name}`
      case 'RUBYGEMS': return `https://rubygems.org/gems/${vuln.package.name}`
      case 'RUST': return `https://crates.io/crates/${vuln.package.name}`
    }
  }

  return (
    <tr key={vuln.id} className='border-b border-gray-300'>
      <td className='w-[13%] text-center py-1'>
        <span className={`font-semibold text-xs text-${severityColor()} border border-${severityColor()} rounded-xl px-2 py-[1px]`}>
          {vuln.severity.toLowerCase()}
        </span>
      </td>
      <td className='w-[17%] tabular-nums'>
        <a href={advisory.permalink}>{identifier}</a>
      </td>
      <td className='w-[46%]'>
        <a href={packageLink()}>{vuln.package.name}</a>
      </td>
      <td className='w-[13%] text-center'>{vuln.vulnerableVersionRange}</td>
      <td className='w-[11%] text-center'>{vuln.firstPatchedVersion?.identifier ?? 'Unknown'}</td>
    </tr>
  )
}
