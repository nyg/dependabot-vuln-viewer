const severityColor = {
  LOW: { text: 'text-yellow-400', border: 'border-yellow-400' },
  MODERATE: { text: 'text-orange-400', border: 'border-orange-400' },
  HIGH: { text: 'text-red-600', border: 'border-red-600' },
  CRITICAL: { text: 'text-red-800', border: 'border-red-800' }
}

export default function Vulnerability({ advisory, vuln }) {

  advisory.identifiers.sort((id, another) => id.type.localeCompare(another.type))
  const identifier = advisory.identifiers[0]?.value ?? 'Unknown identifier'

  const packageLink = () => {
    switch (vuln.package.ecosystem) {
      case 'COMPOSER': return `https://packagist.org/packages/${vuln.package.name}`
      case 'GO': return `https://pkg.go.dev/${vuln.package.name}`
      case 'MAVEN': return `https://mvnrepository.com/artifact/${vuln.package.name.replace(':', '/')}`
      case 'NPM': return `https://www.npmjs.com/package/${vuln.package.name}`
      case 'NUGET': return `https://www.nuget.org/packages/${vuln.package.name}`
      case 'PIP': return `https://pypi.org/project/${vuln.package.name}`
      case 'RUBYGEMS': return `https://rubygems.org/gems/${vuln.package.name}`
      case 'RUST': return `https://crates.io/crates/${vuln.package.name}`
    }
  }

  return (
    <tr className='border-b border-b-gray-300'>
      <td className='w-[13%] text-center py-1'>
        <span className={`font-semibold text-xs ${severityColor[vuln.severity].text} border ${severityColor[vuln.severity].border} rounded-xl px-2 py-[1px]`}>
          {vuln.severity.toLowerCase()}
        </span>
      </td>
      <td className='w-[17%] tabular-nums'>
        <a href={advisory.permalink}>{identifier}</a>
      </td>
      <td className='w-[46%]'>
        <a href={packageLink()}>{vuln.package.name}</a>
      </td>
      <td className='w-[13%] text-center'>{vuln.vulnerableVersionRange}</td>
      <td className='w-[11%] text-center'>{vuln.firstPatchedVersion?.identifier ?? 'Unknown'}</td>
    </tr>
  )
}
