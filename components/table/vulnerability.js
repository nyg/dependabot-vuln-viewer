import { severityColor, cveFirstThenGhsa } from "../../utils/config"

const packageLink = (ecosystem, name) => {
  switch (ecosystem) {
    case 'COMPOSER': return `https://packagist.org/packages/${name}`
    case 'GO': return `https://pkg.go.dev/${name}`
    case 'MAVEN': return `https://mvnrepository.com/artifact/${name.replace(':', '/')}`
    case 'NPM': return `https://www.npmjs.com/package/${name}`
    case 'NUGET': return `https://www.nuget.org/packages/${name}`
    case 'PIP': return `https://pypi.org/project/${name}`
    case 'RUBYGEMS': return `https://rubygems.org/gems/${name}`
    case 'RUST': return `https://crates.io/crates/${name}`
  }
}


export default function Vulnerability({ advisory, vuln }) {

  const identifier = () => [...advisory.identifiers].sort(cveFirstThenGhsa)[0]?.value ?? 'Unknown identifier'

  return (
    <tr className='border-b border-b-gray-300'>
      <td className='w-[13%] text-center py-1'>
        <span className={`font-semibold text-xs ${severityColor[vuln.severity].text} border ${severityColor[vuln.severity].border} rounded-xl px-2 py-[1px]`}>
          {vuln.severity.toLowerCase()}
        </span>
      </td>
      <td className='w-[17%] tabular-nums'>
        <a href={advisory.permalink} target='_blank'>{identifier()}</a>
      </td>
      <td className='w-[46%]'>
        <a href={packageLink(vuln.package.ecosystem, vuln.package.name)} target='_blank'>{vuln.package.name}</a>
      </td>
      <td className='w-[13%] text-center'>{vuln.vulnerableVersionRange}</td>
      <td className='w-[11%] text-center'>{vuln.firstPatchedVersion?.identifier ?? 'Unknown'}</td>
    </tr>
  )
}
