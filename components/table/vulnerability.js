import { severityColor, cveFirstThenGhsa } from '../../utils/config'
import { packageLink } from '../../utils/config'
import Link from '../link'


export default function Vulnerability({ advisory, vuln }) {

   const identifier = () => [...advisory.identifiers].sort(cveFirstThenGhsa)[0]?.value ?? 'Unknown identifier'

   return (
      <tr className='border-b border-b-gray-300'>
         <td className='w-[13%] text-center py-1'>
            <span className={`font-semibold text-xs ${severityColor[vuln.severity].text} border ${severityColor[vuln.severity].border} rounded-xl px-2 py-[1px]`}>
               {vuln.severity.toLowerCase()}
            </span>
         </td>
         <td className='w-[17%] tabular-nums'>
            <Link href={advisory.permalink}>{identifier()}</Link>
         </td>
         <td className='w-[45%]'>
            <Link href={packageLink(vuln.package.ecosystem, vuln.package.name)}>{vuln.package.name}</Link>
         </td>
         <td className='w-[14%] text-center'>{vuln.vulnerableVersionRange}</td>
         <td className='w-[11%] text-center'>{vuln.firstPatchedVersion?.identifier ?? 'Unknown'}</td>
      </tr>
   )
}
